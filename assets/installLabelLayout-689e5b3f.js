import{ai as N,B as C,av as Y,z as U,a5 as _,aj as P,cJ as z,n as T,cK as H,bJ as K,cL as V,e as W,cM as j,bT as w,am as J,bK as R,aJ as A,Y as O,cN as F,W as M}from"./install-32865521.js";import{s as I,g as $,u as X}from"./labelGuideHelper-b5c36f4b.js";function q(l){if(l){for(var i=[],r=0;r<l.length;r++)i.push(l[r].slice());return i}}function Q(l,i){var r=l.label,a=i&&i.getTextGuideLine();return{dataIndex:l.dataIndex,dataType:l.dataType,seriesIndex:l.seriesModel.seriesIndex,text:l.label.style.text,rect:l.hostRect,labelRect:l.rect,align:r.style.align,verticalAlign:r.style.verticalAlign,labelLinePoints:q(a&&a.shape.points)}}var E=["align","verticalAlign","width","height","fontSize"],f=new N,b=M(),Z=M();function y(l,i,r){for(var a=0;a<r.length;a++){var e=r[a];i[e]!=null&&(l[e]=i[e])}}var x=["x","y","rotation"],k=function(){function l(){this._labelList=[],this._chartViewList=[]}return l.prototype.clearLabels=function(){this._labelList=[],this._chartViewList=[]},l.prototype._addLabel=function(i,r,a,e,o){var t=e.style,n=e.__hostTarget,v=n.textConfig||{},g=e.getComputedTransform(),s=e.getBoundingRect().plain();C.applyTransform(s,s,g),g?f.setLocalTransform(g):(f.x=f.y=f.rotation=f.originX=f.originY=0,f.scaleX=f.scaleY=1);var d=e.__hostTarget,c;if(d){c=d.getBoundingRect().plain();var L=d.getComputedTransform();C.applyTransform(c,c,L)}var u=c&&d.getTextGuideLine();this._labelList.push({label:e,labelLine:u,seriesModel:a,dataIndex:i,dataType:r,layoutOption:o,computedLayoutOption:null,rect:s,hostRect:c,priority:c?c.width*c.height:0,defaultAttr:{ignore:e.ignore,labelGuideIgnore:u&&u.ignore,x:f.x,y:f.y,scaleX:f.scaleX,scaleY:f.scaleY,rotation:f.rotation,style:{x:t.x,y:t.y,align:t.align,verticalAlign:t.verticalAlign,width:t.width,height:t.height,fontSize:t.fontSize},cursor:e.cursor,attachedPos:v.position,attachedRot:v.rotation}})},l.prototype.addLabelsOfSeries=function(i){var r=this;this._chartViewList.push(i);var a=i.__model,e=a.get("labelLayout");(Y(e)||U(e).length)&&i.group.traverse(function(o){if(o.ignore)return!0;var t=o.getTextContent(),n=_(o);t&&!t.disableLabelLayout&&r._addLabel(n.dataIndex,n.dataType,a,t,e)})},l.prototype.updateLayoutConfig=function(i){var r=i.getWidth(),a=i.getHeight();function e(D,G){return function(){X(D,G)}}for(var o=0;o<this._labelList.length;o++){var t=this._labelList[o],n=t.label,v=n.__hostTarget,g=t.defaultAttr,s=void 0;Y(t.layoutOption)?s=t.layoutOption(Q(t,v)):s=t.layoutOption,s=s||{},t.computedLayoutOption=s;var d=Math.PI/180;v&&v.setTextConfig({local:!1,position:s.x!=null||s.y!=null?null:g.attachedPos,rotation:s.rotate!=null?s.rotate*d:g.attachedRot,offset:[s.dx||0,s.dy||0]});var c=!1;if(s.x!=null?(n.x=P(s.x,r),n.setStyle("x",0),c=!0):(n.x=g.x,n.setStyle("x",g.style.x)),s.y!=null?(n.y=P(s.y,a),n.setStyle("y",0),c=!0):(n.y=g.y,n.setStyle("y",g.style.y)),s.labelLinePoints){var L=v.getTextGuideLine();L&&(L.setShape({points:s.labelLinePoints}),c=!1)}var u=b(n);u.needsUpdateLabelLine=c,n.rotation=s.rotate!=null?s.rotate*d:g.rotation,n.scaleX=g.scaleX,n.scaleY=g.scaleY;for(var p=0;p<E.length;p++){var h=E[p];n.setStyle(h,s[h]!=null?s[h]:g.style[h])}if(s.draggable){if(n.draggable=!0,n.cursor="move",v){var S=t.seriesModel;if(t.dataIndex!=null){var B=t.seriesModel.getData(t.dataType);S=B.getItemModel(t.dataIndex)}n.on("drag",e(v,S.getModel("labelLine")))}}else n.off("drag"),n.cursor=g.cursor}},l.prototype.layout=function(i){var r=i.getWidth(),a=i.getHeight(),e=z(this._labelList),o=T(e,function(v){return v.layoutOption.moveOverlap==="shiftX"}),t=T(e,function(v){return v.layoutOption.moveOverlap==="shiftY"});H(o,0,r),K(t,0,a);var n=T(e,function(v){return v.layoutOption.hideOverlap});V(n)},l.prototype.processLabelsOverall=function(){var i=this;W(this._chartViewList,function(r){var a=r.__model,e=r.ignoreLabelLineUpdate,o=a.isAnimationEnabled();r.group.traverse(function(t){if(t.ignore&&!t.forceLabelAnimation)return!0;var n=!e,v=t.getTextContent();!n&&v&&(n=b(v).needsUpdateLabelLine),n&&i._updateLabelLine(t,a),o&&i._animateLabels(t,a)})})},l.prototype._updateLabelLine=function(i,r){var a=i.getTextContent(),e=_(i),o=e.dataIndex;if(a&&o!=null){var t=r.getData(e.dataType),n=t.getItemModel(o),v={},g=t.getItemVisual(o,"style"),s=t.getVisual("drawType");v.stroke=g[s];var d=n.getModel("labelLine");I(i,$(n),v),X(i,d)}},l.prototype._animateLabels=function(i,r){var a=i.getTextContent(),e=i.getTextGuideLine();if(a&&(i.forceLabelAnimation||!a.ignore&&!a.invisible&&!i.disableLabelAnimation&&!j(i))){var o=b(a),t=o.oldLayout,n=_(i),v=n.dataIndex,g={x:a.x,y:a.y,rotation:a.rotation},s=r.getData(n.dataType);if(t){a.attr(t);var c=i.prevStates;c&&(A(c,"select")>=0&&a.attr(o.oldLayoutSelect),A(c,"emphasis")>=0&&a.attr(o.oldLayoutEmphasis)),O(a,g,r,v)}else if(a.attr(g),!w(a).valueAnimation){var d=J(a.style.opacity,1);a.style.opacity=0,R(a,{style:{opacity:d}},r,v)}if(o.oldLayout=g,a.states.select){var L=o.oldLayoutSelect={};y(L,g,x),y(L,a.states.select,x)}if(a.states.emphasis){var u=o.oldLayoutEmphasis={};y(u,g,x),y(u,a.states.emphasis,x)}F(a,v,s,r,r)}if(e&&!e.ignore&&!e.invisible){var o=Z(e),t=o.oldLayout,p={points:e.shape.points};t?(e.attr({shape:t}),O(e,{shape:p},r)):(e.setShape(p),e.style.strokePercent=0,R(e,{style:{strokePercent:1}},r)),o.oldLayout=p}},l}();const ee=k;var m=M();function re(l){l.registerUpdateLifecycle("series:beforeupdate",function(i,r,a){var e=m(r).labelManager;e||(e=m(r).labelManager=new ee),e.clearLabels()}),l.registerUpdateLifecycle("series:layoutlabels",function(i,r,a){var e=m(r).labelManager;a.updatedSeries.forEach(function(o){e.addLabelsOfSeries(r.getViewOfSeriesModel(o))}),e.updateLayoutConfig(r),e.layout(r),e.processLabelsOverall()})}export{re as i};
