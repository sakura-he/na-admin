import{aE as Pe,ar as xe,aB as ne,aj as C,e as Z,b1 as ue,bl as me,bJ as Te,l as Ne,b5 as Ie,_ as ie,aY as Ce,a1 as B,bK as ae,Y as he,bL as Oe,bM as Ee,a7 as Re,a3 as ke,a4 as Be,F as Ve,bN as Ge,bO as be,bP as Ye,ac as Fe,q as fe,ad as ye,ae as ze,bQ as Ue,as as Xe,ah as He,W as $e,az as qe}from"./install-32865521.js";import{L as Ze,d as _e}from"./LegendVisualProvider-3935ed15.js";import{l as je,a as Je,s as Ke,g as Qe}from"./labelGuideHelper-b5c36f4b.js";import{c as We}from"./createSeriesDataSimply-e2b30047.js";var _=Math.PI*2,de=Math.PI/180;function Se(a,l){return xe(a.getBoxLayoutParams(),{width:l.getWidth(),height:l.getHeight()})}function Ae(a,l){var r=Se(a,l),e=a.get("center"),n=a.get("radius");ne(n)||(n=[0,n]);var o=C(r.width,l.getWidth()),t=C(r.height,l.getHeight()),v=Math.min(o,t),c=C(n[0],v/2),f=C(n[1],v/2),g,p,h=a.coordinateSystem;if(h){var i=h.dataToPoint(e);g=i[0]||0,p=i[1]||0}else ne(e)||(e=[e,e]),g=C(e[0],o)+r.x,p=C(e[1],t)+r.y;return{cx:g,cy:p,r0:c,r:f}}function et(a,l,r){l.eachSeriesByType(a,function(e){var n=e.getData(),o=n.mapDimension("value"),t=Se(e,r),v=Ae(e,r),c=v.cx,f=v.cy,g=v.r,p=v.r0,h=-e.get("startAngle")*de,i=e.get("minAngle")*de,s=0;n.each(o,function(P){!isNaN(P)&&s++});var u=n.getSum(o),d=Math.PI/(u||s)*2,b=e.get("clockwise"),y=e.get("roseType"),S=e.get("stillShowZeroSum"),x=n.getDataExtent(o);x[0]=0;var A=_,D=0,M=h,m=b?1:-1;if(n.setLayout({viewRect:t,r:g}),n.each(o,function(P,N){var w;if(isNaN(P)){n.setItemLayout(N,{angle:NaN,startAngle:NaN,endAngle:NaN,clockwise:b,cx:c,cy:f,r0:p,r:y?NaN:g});return}y!=="area"?w=u===0&&S?d:P*d:w=_/s,w<i?(w=i,A-=i):D+=P;var T=M+m*w;n.setItemLayout(N,{angle:w,startAngle:M,endAngle:T,clockwise:b,cx:c,cy:f,r0:p,r:y?Pe(P,x,[p,g]):g}),M=T}),A<_&&s)if(A<=.001){var L=_/s;n.each(o,function(P,N){if(!isNaN(P)){var w=n.getItemLayout(N);w.angle=L,w.startAngle=h+m*N*L,w.endAngle=h+m*(N+1)*L}})}else d=A/D,M=h,n.each(o,function(P,N){if(!isNaN(P)){var w=n.getItemLayout(N),T=w.angle===i?i:P*d;w.startAngle=M,w.endAngle=M+m*T,M+=m*T}})})}var tt=Math.PI/180;function pe(a,l,r,e,n,o,t,v,c,f){if(a.length<2)return;function g(u){for(var d=u.rB,b=d*d,y=0;y<u.list.length;y++){var S=u.list[y],x=Math.abs(S.label.y-r),A=e+S.len,D=A*A,M=Math.sqrt((1-Math.abs(x*x/b))*D),m=l+(M+S.len2)*n,L=m-S.label.x,P=S.targetTextWidth-L*n;Le(S,P,!0),S.label.x=m}}function p(u){for(var d={list:[],maxY:0},b={list:[],maxY:0},y=0;y<u.length;y++)if(u[y].labelAlignTo==="none"){var S=u[y],x=S.label.y>r?b:d,A=Math.abs(S.label.y-r);if(A>=x.maxY){var D=S.label.x-l-S.len2*n,M=e+S.len,m=Math.abs(D)<M?Math.sqrt(A*A/(1-D*D/M/M)):M;x.rB=m,x.maxY=A}x.list.push(S)}g(d),g(b)}for(var h=a.length,i=0;i<h;i++)if(a[i].position==="outer"&&a[i].labelAlignTo==="labelLine"){var s=a[i].label.x-f;a[i].linePoints[1][0]+=s,a[i].label.x=f}Te(a,c,c+t)&&p(a)}function at(a,l,r,e,n,o,t,v){for(var c=[],f=[],g=Number.MAX_VALUE,p=-Number.MAX_VALUE,h=0;h<a.length;h++){var i=a[h].label;re(a[h])||(i.x<l?(g=Math.min(g,i.x),c.push(a[h])):(p=Math.max(p,i.x),f.push(a[h])))}for(var h=0;h<a.length;h++){var s=a[h];if(!re(s)&&s.linePoints){if(s.labelStyleWidth!=null)continue;var i=s.label,u=s.linePoints,d=void 0;s.labelAlignTo==="edge"?i.x<l?d=u[2][0]-s.labelDistance-t-s.edgeDistance:d=t+n-s.edgeDistance-u[2][0]-s.labelDistance:s.labelAlignTo==="labelLine"?i.x<l?d=g-t-s.bleedMargin:d=t+n-p-s.bleedMargin:i.x<l?d=i.x-t-s.bleedMargin:d=t+n-i.x-s.bleedMargin,s.targetTextWidth=d,Le(s,d)}}pe(f,l,r,e,1,n,o,t,v,p),pe(c,l,r,e,-1,n,o,t,v,g);for(var h=0;h<a.length;h++){var s=a[h];if(!re(s)&&s.linePoints){var i=s.label,u=s.linePoints,b=s.labelAlignTo==="edge",y=i.style.padding,S=y?y[1]+y[3]:0,x=i.style.backgroundColor?0:S,A=s.rect.width+x,D=u[1][0]-u[2][0];b?i.x<l?u[2][0]=t+s.edgeDistance+A+s.labelDistance:u[2][0]=t+n-s.edgeDistance-A-s.labelDistance:(i.x<l?u[2][0]=i.x+s.labelDistance:u[2][0]=i.x-s.labelDistance,u[1][0]=u[2][0]+D),u[1][1]=u[2][1]=i.y}}}function Le(a,l,r){if(r===void 0&&(r=!1),a.labelStyleWidth==null){var e=a.label,n=e.style,o=a.rect,t=n.backgroundColor,v=n.padding,c=v?v[1]+v[3]:0,f=n.overflow,g=o.width+(t?0:c);if(l<g||r){var p=o.height;if(f&&f.match("break")){e.setStyle("backgroundColor",null),e.setStyle("width",l-c);var h=e.getBoundingRect();e.setStyle("width",Math.ceil(h.width)),e.setStyle("backgroundColor",t)}else{var i=l-c,s=l<g?i:r?i>a.unconstrainedWidth?null:i:null;e.setStyle("width",s)}var u=e.getBoundingRect();o.width=u.width;var d=(e.style.margin||0)+2.1;o.height=u.height+d,o.y-=(o.height-p)/2}}}function re(a){return a.position==="center"}function rt(a){var l=a.getData(),r=[],e,n,o=!1,t=(a.get("minShowLabelAngle")||0)*tt,v=l.getLayout("viewRect"),c=l.getLayout("r"),f=v.width,g=v.x,p=v.y,h=v.height;function i(D){D.ignore=!0}function s(D){if(!D.ignore)return!0;for(var M in D.states)if(D.states[M].ignore===!1)return!0;return!1}l.each(function(D){var M=l.getItemGraphicEl(D),m=M.shape,L=M.getTextContent(),P=M.getTextGuideLine(),N=l.getItemModel(D),w=N.getModel("label"),T=w.get("position")||N.get(["emphasis","label","position"]),J=w.get("distanceToLabelLine"),K=w.get("alignTo"),Q=C(w.get("edgeDistance"),f),Me=w.get("bleedMargin"),U=N.getModel("labelLine"),V=U.get("length");V=C(V,f);var X=U.get("length2");if(X=C(X,f),Math.abs(m.endAngle-m.startAngle)<t){Z(L.states,i),L.ignore=!0,P&&(Z(P.states,i),P.ignore=!0);return}if(s(L)){var H=(m.startAngle+m.endAngle)/2,I=Math.cos(H),O=Math.sin(H),G,$,le,q;e=m.cx,n=m.cy;var E=T==="inside"||T==="inner";if(T==="center")G=m.cx,$=m.cy,q="center";else{var W=(E?(m.r+m.r0)/2*I:m.r*I)+e,ee=(E?(m.r+m.r0)/2*O:m.r*O)+n;if(G=W+I*3,$=ee+O*3,!E){var se=W+I*(V+c-m.r),oe=ee+O*(V+c-m.r),ge=se+(I<0?-1:1)*X,ve=oe;K==="edge"?G=I<0?g+Q:g+f-Q:G=ge+(I<0?-J:J),$=ve,le=[[W,ee],[se,oe],[ge,ve]]}q=E?"center":K==="edge"?I>0?"right":"left":I>0?"left":"right"}var Y=Math.PI,R=0,F=w.get("rotate");if(me(F))R=F*(Y/180);else if(T==="center")R=0;else if(F==="radial"||F===!0){var we=I<0?-H+Y:-H;R=we}else if(F==="tangential"&&T!=="outside"&&T!=="outer"){var k=Math.atan2(I,O);k<0&&(k=Y*2+k);var De=O>0;De&&(k=Y+k),R=k-Y}if(o=!!R,L.x=G,L.y=$,L.rotation=R,L.setStyle({verticalAlign:"middle"}),E){L.setStyle({align:q});var te=L.states.select;te&&(te.x+=L.x,te.y+=L.y)}else{var z=L.getBoundingRect().clone();z.applyTransform(L.getComputedTransform());var ce=(L.style.margin||0)+2.1;z.y-=ce/2,z.height+=ce,r.push({label:L,labelLine:P,position:T,len:V,len2:X,minTurnAngle:U.get("minTurnAngle"),maxSurfaceAngle:U.get("maxSurfaceAngle"),surfaceNormal:new ue(I,O),linePoints:le,textAlign:q,labelDistance:J,labelAlignTo:K,edgeDistance:Q,bleedMargin:Me,rect:z,unconstrainedWidth:z.width,labelStyleWidth:L.style.width})}M.setTextConfig({inside:E})}}),!o&&a.get("avoidLabelOverlap")&&at(r,e,n,c,f,h,g,p);for(var u=0;u<r.length;u++){var d=r[u],b=d.label,y=d.labelLine,S=isNaN(b.x)||isNaN(b.y);if(b){b.setStyle({align:d.textAlign}),S&&(Z(b.states,i),b.ignore=!0);var x=b.states.select;x&&(x.x+=b.x,x.y+=b.y)}if(y){var A=d.linePoints;S||!A?(Z(y.states,i),y.ignore=!0):(je(A,d.minTurnAngle),Je(A,d.surfaceNormal,d.maxSurfaceAngle),y.setShape({points:A}),b.__hostTarget.textGuideLineConfig={anchor:new ue(A[0][0],A[0][1])})}}}function j(a,l,r){var e=a.get("borderRadius");if(e==null)return r?{cornerRadius:0}:null;ne(e)||(e=[e,e,e,e]);var n=Math.abs(l.r||0-l.r0||0);return{cornerRadius:Ne(e,function(o){return Ie(o,n)})}}var nt=function(a){ie(l,a);function l(r,e,n){var o=a.call(this)||this;o.z2=2;var t=new Ce;return o.setTextContent(t),o.updateData(r,e,n,!0),o}return l.prototype.updateData=function(r,e,n,o){var t=this,v=r.hostModel,c=r.getItemModel(e),f=c.getModel("emphasis"),g=r.getItemLayout(e),p=B(j(c.getModel("itemStyle"),g,!0),g);if(isNaN(p.startAngle)){t.setShape(p);return}if(o){t.setShape(p);var h=v.getShallow("animationType");v.ecModel.ssr?(ae(t,{scaleX:0,scaleY:0},v,{dataIndex:e,isFrom:!0}),t.originX=p.cx,t.originY=p.cy):h==="scale"?(t.shape.r=g.r0,ae(t,{shape:{r:g.r}},v,e)):n!=null?(t.setShape({startAngle:n,endAngle:n}),ae(t,{shape:{startAngle:g.startAngle,endAngle:g.endAngle}},v,e)):(t.shape.endAngle=g.startAngle,he(t,{shape:{endAngle:g.endAngle}},v,e))}else Oe(t),he(t,{shape:p},v,e);t.useStyle(r.getItemVisual(e,"style")),Ee(t,c);var i=(g.startAngle+g.endAngle)/2,s=v.get("selectedOffset"),u=Math.cos(i)*s,d=Math.sin(i)*s,b=c.getShallow("cursor");b&&t.attr("cursor",b),this._updateLabel(v,r,e),t.ensureState("emphasis").shape=B({r:g.r+(f.get("scale")&&f.get("scaleSize")||0)},j(f.getModel("itemStyle"),g)),B(t.ensureState("select"),{x:u,y:d,shape:j(c.getModel(["select","itemStyle"]),g)}),B(t.ensureState("blur"),{shape:j(c.getModel(["blur","itemStyle"]),g)});var y=t.getTextGuideLine(),S=t.getTextContent();y&&B(y.ensureState("select"),{x:u,y:d}),B(S.ensureState("select"),{x:u,y:d}),Re(this,f.get("focus"),f.get("blurScope"),f.get("disabled"))},l.prototype._updateLabel=function(r,e,n){var o=this,t=e.getItemModel(n),v=t.getModel("labelLine"),c=e.getItemVisual(n,"style"),f=c&&c.fill,g=c&&c.opacity;ke(o,Be(t),{labelFetcher:e.hostModel,labelDataIndex:n,inheritColor:f,defaultOpacity:g,defaultText:r.getFormattedLabel(n,"normal")||e.getName(n)});var p=o.getTextContent();o.setTextConfig({position:null,rotation:null}),p.attr({z2:10});var h=r.get(["label","position"]);if(h!=="outside"&&h!=="outer")o.removeTextGuideLine();else{var i=this.getTextGuideLine();i||(i=new Ve,this.setTextGuideLine(i)),Ke(this,Qe(t),{stroke:f,opacity:Ge(v.get(["lineStyle","opacity"]),g,1)})}},l}(be),it=function(a){ie(l,a);function l(){var r=a!==null&&a.apply(this,arguments)||this;return r.ignoreLabelLineUpdate=!0,r}return l.prototype.render=function(r,e,n,o){var t=r.getData(),v=this._data,c=this.group,f;if(!v&&t.count()>0){for(var g=t.getItemLayout(0),p=1;isNaN(g&&g.startAngle)&&p<t.count();++p)g=t.getItemLayout(p);g&&(f=g.startAngle)}if(this._emptyCircleSector&&c.remove(this._emptyCircleSector),t.count()===0&&r.get("showEmptyCircle")){var h=new be({shape:Ae(r,n)});h.useStyle(r.getModel("emptyCircleStyle").getItemStyle()),this._emptyCircleSector=h,c.add(h)}t.diff(v).add(function(i){var s=new nt(t,i,f);t.setItemGraphicEl(i,s),c.add(s)}).update(function(i,s){var u=v.getItemGraphicEl(s);u.updateData(t,i,f),u.off("click"),c.add(u),t.setItemGraphicEl(i,u)}).remove(function(i){var s=v.getItemGraphicEl(i);Ye(s,r,i)}).execute(),rt(r),r.get("animationTypeUpdate")!=="expansion"&&(this._data=t)},l.prototype.dispose=function(){},l.prototype.containPoint=function(r,e){var n=e.getData(),o=n.getItemLayout(0);if(o){var t=r[0]-o.cx,v=r[1]-o.cy,c=Math.sqrt(t*t+v*v);return c<=o.r&&c>=o.r0}},l.type="pie",l}(Fe);const lt=it;var st=$e(),ot=function(a){ie(l,a);function l(){return a!==null&&a.apply(this,arguments)||this}return l.prototype.init=function(r){a.prototype.init.apply(this,arguments),this.legendVisualProvider=new Ze(fe(this.getData,this),fe(this.getRawData,this)),this._defaultLabelLine(r)},l.prototype.mergeOption=function(){a.prototype.mergeOption.apply(this,arguments)},l.prototype.getInitialData=function(){return We(this,{coordDimensions:["value"],encodeDefaulter:ye(ze,this)})},l.prototype.getDataParams=function(r){var e=this.getData(),n=st(e),o=n.seats;if(!o){var t=[];e.each(e.mapDimension("value"),function(c){t.push(c)}),o=n.seats=Ue(t,e.hostModel.get("percentPrecision"))}var v=a.prototype.getDataParams.call(this,r);return v.percent=o[r]||0,v.$vars.push("percent"),v},l.prototype._defaultLabelLine=function(r){Xe(r,"labelLine",["show"]);var e=r.labelLine,n=r.emphasis.labelLine;e.show=e.show&&r.label.show,n.show=n.show&&r.emphasis.label.show},l.type="series.pie",l.defaultOption={z:2,legendHoverLink:!0,colorBy:"data",center:["50%","50%"],radius:[0,"75%"],clockwise:!0,startAngle:90,minAngle:0,minShowLabelAngle:0,selectedOffset:10,percentPrecision:2,stillShowZeroSum:!0,left:0,top:0,right:0,bottom:0,width:null,height:null,label:{rotate:0,show:!0,overflow:"truncate",position:"outer",alignTo:"none",edgeDistance:"25%",bleedMargin:10,distanceToLabelLine:5},labelLine:{show:!0,length:15,length2:15,smooth:!1,minTurnAngle:90,maxSurfaceAngle:90,lineStyle:{width:1,type:"solid"}},itemStyle:{borderWidth:1,borderJoin:"round"},showEmptyCircle:!0,emptyCircleStyle:{color:"lightgray",opacity:1},labelLayout:{hideOverlap:!0},emphasis:{scale:!0,scaleSize:5},avoidLabelOverlap:!0,animationType:"expansion",animationDuration:1e3,animationTypeUpdate:"transition",animationEasingUpdate:"cubicInOut",animationDurationUpdate:500,animationEasing:"cubicInOut"},l}(He);const gt=ot;function vt(a){return{seriesType:a,reset:function(l,r){var e=l.getData();e.filterSelf(function(n){var o=e.mapDimension("value"),t=e.get(o,n);return!(me(t)&&!isNaN(t)&&t<0)})}}}function dt(a){a.registerChartView(lt),a.registerSeriesModel(gt),qe("pie",a.registerAction),a.registerLayout(ye(et,"pie")),a.registerProcessor(_e("pie")),a.registerProcessor(vt("pie"))}export{dt as i};
