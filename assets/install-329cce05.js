import{cn as Pe,ag as xe,$ as ne,bw as C,j as Z,bG as ue,w as me,bz as Te,m as Ne,cF as Ie,a4 as ie,bc as Ce,q as V,aU as ae,aS as he,aT as Oe,b8 as Ee,aY as Re,aX as ke,aV as Ve,c0 as Be,cQ as Ge,b6 as be,cL as Fe,ba as Ye,bv as fe,aF as ye,cc as Ue,cR as Xe,ci as ze,aO as $e,aq as qe,cl as He}from"./install-d8df1eea.js";import{L as Ze,d as _e}from"./LegendVisualProvider-3935ed15.js";import{l as je,a as Je,s as Qe,g as Ke}from"./labelGuideHelper-86309a77.js";import{c as We}from"./createSeriesDataSimply-3140ddc9.js";var _=Math.PI*2,de=Math.PI/180;function Se(a,l){return xe(a.getBoxLayoutParams(),{width:l.getWidth(),height:l.getHeight()})}function Ae(a,l){var r=Se(a,l),e=a.get("center"),n=a.get("radius");ne(n)||(n=[0,n]);var o=C(r.width,l.getWidth()),t=C(r.height,l.getHeight()),c=Math.min(o,t),v=C(n[0],c/2),f=C(n[1],c/2),g,p,h=a.coordinateSystem;if(h){var i=h.dataToPoint(e);g=i[0]||0,p=i[1]||0}else ne(e)||(e=[e,e]),g=C(e[0],o)+r.x,p=C(e[1],t)+r.y;return{cx:g,cy:p,r0:v,r:f}}function et(a,l,r){l.eachSeriesByType(a,function(e){var n=e.getData(),o=n.mapDimension("value"),t=Se(e,r),c=Ae(e,r),v=c.cx,f=c.cy,g=c.r,p=c.r0,h=-e.get("startAngle")*de,i=e.get("minAngle")*de,s=0;n.each(o,function(P){!isNaN(P)&&s++});var u=n.getSum(o),d=Math.PI/(u||s)*2,b=e.get("clockwise"),y=e.get("roseType"),S=e.get("stillShowZeroSum"),x=n.getDataExtent(o);x[0]=0;var A=_,D=0,w=h,m=b?1:-1;if(n.setLayout({viewRect:t,r:g}),n.each(o,function(P,N){var M;if(isNaN(P)){n.setItemLayout(N,{angle:NaN,startAngle:NaN,endAngle:NaN,clockwise:b,cx:v,cy:f,r0:p,r:y?NaN:g});return}y!=="area"?M=u===0&&S?d:P*d:M=_/s,M<i?(M=i,A-=i):D+=P;var T=w+m*M;n.setItemLayout(N,{angle:M,startAngle:w,endAngle:T,clockwise:b,cx:v,cy:f,r0:p,r:y?Pe(P,x,[p,g]):g}),w=T}),A<_&&s)if(A<=.001){var L=_/s;n.each(o,function(P,N){if(!isNaN(P)){var M=n.getItemLayout(N);M.angle=L,M.startAngle=h+m*N*L,M.endAngle=h+m*(N+1)*L}})}else d=A/D,w=h,n.each(o,function(P,N){if(!isNaN(P)){var M=n.getItemLayout(N),T=M.angle===i?i:P*d;M.startAngle=w,M.endAngle=w+m*T,w+=m*T}})})}var tt=Math.PI/180;function pe(a,l,r,e,n,o,t,c,v,f){if(a.length<2)return;function g(u){for(var d=u.rB,b=d*d,y=0;y<u.list.length;y++){var S=u.list[y],x=Math.abs(S.label.y-r),A=e+S.len,D=A*A,w=Math.sqrt((1-Math.abs(x*x/b))*D),m=l+(w+S.len2)*n,L=m-S.label.x,P=S.targetTextWidth-L*n;Le(S,P,!0),S.label.x=m}}function p(u){for(var d={list:[],maxY:0},b={list:[],maxY:0},y=0;y<u.length;y++)if(u[y].labelAlignTo==="none"){var S=u[y],x=S.label.y>r?b:d,A=Math.abs(S.label.y-r);if(A>=x.maxY){var D=S.label.x-l-S.len2*n,w=e+S.len,m=Math.abs(D)<w?Math.sqrt(A*A/(1-D*D/w/w)):w;x.rB=m,x.maxY=A}x.list.push(S)}g(d),g(b)}for(var h=a.length,i=0;i<h;i++)if(a[i].position==="outer"&&a[i].labelAlignTo==="labelLine"){var s=a[i].label.x-f;a[i].linePoints[1][0]+=s,a[i].label.x=f}Te(a,v,v+t)&&p(a)}function at(a,l,r,e,n,o,t,c){for(var v=[],f=[],g=Number.MAX_VALUE,p=-Number.MAX_VALUE,h=0;h<a.length;h++){var i=a[h].label;re(a[h])||(i.x<l?(g=Math.min(g,i.x),v.push(a[h])):(p=Math.max(p,i.x),f.push(a[h])))}for(var h=0;h<a.length;h++){var s=a[h];if(!re(s)&&s.linePoints){if(s.labelStyleWidth!=null)continue;var i=s.label,u=s.linePoints,d=void 0;s.labelAlignTo==="edge"?i.x<l?d=u[2][0]-s.labelDistance-t-s.edgeDistance:d=t+n-s.edgeDistance-u[2][0]-s.labelDistance:s.labelAlignTo==="labelLine"?i.x<l?d=g-t-s.bleedMargin:d=t+n-p-s.bleedMargin:i.x<l?d=i.x-t-s.bleedMargin:d=t+n-i.x-s.bleedMargin,s.targetTextWidth=d,Le(s,d)}}pe(f,l,r,e,1,n,o,t,c,p),pe(v,l,r,e,-1,n,o,t,c,g);for(var h=0;h<a.length;h++){var s=a[h];if(!re(s)&&s.linePoints){var i=s.label,u=s.linePoints,b=s.labelAlignTo==="edge",y=i.style.padding,S=y?y[1]+y[3]:0,x=i.style.backgroundColor?0:S,A=s.rect.width+x,D=u[1][0]-u[2][0];b?i.x<l?u[2][0]=t+s.edgeDistance+A+s.labelDistance:u[2][0]=t+n-s.edgeDistance-A-s.labelDistance:(i.x<l?u[2][0]=i.x+s.labelDistance:u[2][0]=i.x-s.labelDistance,u[1][0]=u[2][0]+D),u[1][1]=u[2][1]=i.y}}}function Le(a,l,r){if(r===void 0&&(r=!1),a.labelStyleWidth==null){var e=a.label,n=e.style,o=a.rect,t=n.backgroundColor,c=n.padding,v=c?c[1]+c[3]:0,f=n.overflow,g=o.width+(t?0:v);if(l<g||r){var p=o.height;if(f&&f.match("break")){e.setStyle("backgroundColor",null),e.setStyle("width",l-v);var h=e.getBoundingRect();e.setStyle("width",Math.ceil(h.width)),e.setStyle("backgroundColor",t)}else{var i=l-v,s=l<g?i:r?i>a.unconstrainedWidth?null:i:null;e.setStyle("width",s)}var u=e.getBoundingRect();o.width=u.width;var d=(e.style.margin||0)+2.1;o.height=u.height+d,o.y-=(o.height-p)/2}}}function re(a){return a.position==="center"}function rt(a){var l=a.getData(),r=[],e,n,o=!1,t=(a.get("minShowLabelAngle")||0)*tt,c=l.getLayout("viewRect"),v=l.getLayout("r"),f=c.width,g=c.x,p=c.y,h=c.height;function i(D){D.ignore=!0}function s(D){if(!D.ignore)return!0;for(var w in D.states)if(D.states[w].ignore===!1)return!0;return!1}l.each(function(D){var w=l.getItemGraphicEl(D),m=w.shape,L=w.getTextContent(),P=w.getTextGuideLine(),N=l.getItemModel(D),M=N.getModel("label"),T=M.get("position")||N.get(["emphasis","label","position"]),J=M.get("distanceToLabelLine"),Q=M.get("alignTo"),K=C(M.get("edgeDistance"),f),we=M.get("bleedMargin"),X=N.getModel("labelLine"),B=X.get("length");B=C(B,f);var z=X.get("length2");if(z=C(z,f),Math.abs(m.endAngle-m.startAngle)<t){Z(L.states,i),L.ignore=!0,P&&(Z(P.states,i),P.ignore=!0);return}if(s(L)){var $=(m.startAngle+m.endAngle)/2,I=Math.cos($),O=Math.sin($),G,q,le,H;e=m.cx,n=m.cy;var E=T==="inside"||T==="inner";if(T==="center")G=m.cx,q=m.cy,H="center";else{var W=(E?(m.r+m.r0)/2*I:m.r*I)+e,ee=(E?(m.r+m.r0)/2*O:m.r*O)+n;if(G=W+I*3,q=ee+O*3,!E){var se=W+I*(B+v-m.r),oe=ee+O*(B+v-m.r),ge=se+(I<0?-1:1)*z,ce=oe;Q==="edge"?G=I<0?g+K:g+f-K:G=ge+(I<0?-J:J),q=ce,le=[[W,ee],[se,oe],[ge,ce]]}H=E?"center":Q==="edge"?I>0?"right":"left":I>0?"left":"right"}var F=Math.PI,R=0,Y=M.get("rotate");if(me(Y))R=Y*(F/180);else if(T==="center")R=0;else if(Y==="radial"||Y===!0){var Me=I<0?-$+F:-$;R=Me}else if(Y==="tangential"&&T!=="outside"&&T!=="outer"){var k=Math.atan2(I,O);k<0&&(k=F*2+k);var De=O>0;De&&(k=F+k),R=k-F}if(o=!!R,L.x=G,L.y=q,L.rotation=R,L.setStyle({verticalAlign:"middle"}),E){L.setStyle({align:H});var te=L.states.select;te&&(te.x+=L.x,te.y+=L.y)}else{var U=L.getBoundingRect().clone();U.applyTransform(L.getComputedTransform());var ve=(L.style.margin||0)+2.1;U.y-=ve/2,U.height+=ve,r.push({label:L,labelLine:P,position:T,len:B,len2:z,minTurnAngle:X.get("minTurnAngle"),maxSurfaceAngle:X.get("maxSurfaceAngle"),surfaceNormal:new ue(I,O),linePoints:le,textAlign:H,labelDistance:J,labelAlignTo:Q,edgeDistance:K,bleedMargin:we,rect:U,unconstrainedWidth:U.width,labelStyleWidth:L.style.width})}w.setTextConfig({inside:E})}}),!o&&a.get("avoidLabelOverlap")&&at(r,e,n,v,f,h,g,p);for(var u=0;u<r.length;u++){var d=r[u],b=d.label,y=d.labelLine,S=isNaN(b.x)||isNaN(b.y);if(b){b.setStyle({align:d.textAlign}),S&&(Z(b.states,i),b.ignore=!0);var x=b.states.select;x&&(x.x+=b.x,x.y+=b.y)}if(y){var A=d.linePoints;S||!A?(Z(y.states,i),y.ignore=!0):(je(A,d.minTurnAngle),Je(A,d.surfaceNormal,d.maxSurfaceAngle),y.setShape({points:A}),b.__hostTarget.textGuideLineConfig={anchor:new ue(A[0][0],A[0][1])})}}}function j(a,l,r){var e=a.get("borderRadius");if(e==null)return r?{cornerRadius:0}:null;ne(e)||(e=[e,e,e,e]);var n=Math.abs(l.r||0-l.r0||0);return{cornerRadius:Ne(e,function(o){return Ie(o,n)})}}var nt=function(a){ie(l,a);function l(r,e,n){var o=a.call(this)||this;o.z2=2;var t=new Ce;return o.setTextContent(t),o.updateData(r,e,n,!0),o}return l.prototype.updateData=function(r,e,n,o){var t=this,c=r.hostModel,v=r.getItemModel(e),f=v.getModel("emphasis"),g=r.getItemLayout(e),p=V(j(v.getModel("itemStyle"),g,!0),g);if(isNaN(p.startAngle)){t.setShape(p);return}if(o){t.setShape(p);var h=c.getShallow("animationType");c.ecModel.ssr?(ae(t,{scaleX:0,scaleY:0},c,{dataIndex:e,isFrom:!0}),t.originX=p.cx,t.originY=p.cy):h==="scale"?(t.shape.r=g.r0,ae(t,{shape:{r:g.r}},c,e)):n!=null?(t.setShape({startAngle:n,endAngle:n}),ae(t,{shape:{startAngle:g.startAngle,endAngle:g.endAngle}},c,e)):(t.shape.endAngle=g.startAngle,he(t,{shape:{endAngle:g.endAngle}},c,e))}else Oe(t),he(t,{shape:p},c,e);t.useStyle(r.getItemVisual(e,"style")),Ee(t,v);var i=(g.startAngle+g.endAngle)/2,s=c.get("selectedOffset"),u=Math.cos(i)*s,d=Math.sin(i)*s,b=v.getShallow("cursor");b&&t.attr("cursor",b),this._updateLabel(c,r,e),t.ensureState("emphasis").shape=V({r:g.r+(f.get("scale")&&f.get("scaleSize")||0)},j(f.getModel("itemStyle"),g)),V(t.ensureState("select"),{x:u,y:d,shape:j(v.getModel(["select","itemStyle"]),g)}),V(t.ensureState("blur"),{shape:j(v.getModel(["blur","itemStyle"]),g)});var y=t.getTextGuideLine(),S=t.getTextContent();y&&V(y.ensureState("select"),{x:u,y:d}),V(S.ensureState("select"),{x:u,y:d}),Re(this,f.get("focus"),f.get("blurScope"),f.get("disabled"))},l.prototype._updateLabel=function(r,e,n){var o=this,t=e.getItemModel(n),c=t.getModel("labelLine"),v=e.getItemVisual(n,"style"),f=v&&v.fill,g=v&&v.opacity;ke(o,Ve(t),{labelFetcher:e.hostModel,labelDataIndex:n,inheritColor:f,defaultOpacity:g,defaultText:r.getFormattedLabel(n,"normal")||e.getName(n)});var p=o.getTextContent();o.setTextConfig({position:null,rotation:null}),p.attr({z2:10});var h=r.get(["label","position"]);if(h!=="outside"&&h!=="outer")o.removeTextGuideLine();else{var i=this.getTextGuideLine();i||(i=new Be,this.setTextGuideLine(i)),Qe(this,Ke(t),{stroke:f,opacity:Ge(c.get(["lineStyle","opacity"]),g,1)})}},l}(be),it=function(a){ie(l,a);function l(){var r=a!==null&&a.apply(this,arguments)||this;return r.ignoreLabelLineUpdate=!0,r}return l.prototype.render=function(r,e,n,o){var t=r.getData(),c=this._data,v=this.group,f;if(!c&&t.count()>0){for(var g=t.getItemLayout(0),p=1;isNaN(g&&g.startAngle)&&p<t.count();++p)g=t.getItemLayout(p);g&&(f=g.startAngle)}if(this._emptyCircleSector&&v.remove(this._emptyCircleSector),t.count()===0&&r.get("showEmptyCircle")){var h=new be({shape:Ae(r,n)});h.useStyle(r.getModel("emptyCircleStyle").getItemStyle()),this._emptyCircleSector=h,v.add(h)}t.diff(c).add(function(i){var s=new nt(t,i,f);t.setItemGraphicEl(i,s),v.add(s)}).update(function(i,s){var u=c.getItemGraphicEl(s);u.updateData(t,i,f),u.off("click"),v.add(u),t.setItemGraphicEl(i,u)}).remove(function(i){var s=c.getItemGraphicEl(i);Fe(s,r,i)}).execute(),rt(r),r.get("animationTypeUpdate")!=="expansion"&&(this._data=t)},l.prototype.dispose=function(){},l.prototype.containPoint=function(r,e){var n=e.getData(),o=n.getItemLayout(0);if(o){var t=r[0]-o.cx,c=r[1]-o.cy,v=Math.sqrt(t*t+c*c);return v<=o.r&&v>=o.r0}},l.type="pie",l}(Ye);const lt=it;var st=qe(),ot=function(a){ie(l,a);function l(){return a!==null&&a.apply(this,arguments)||this}return l.prototype.init=function(r){a.prototype.init.apply(this,arguments),this.legendVisualProvider=new Ze(fe(this.getData,this),fe(this.getRawData,this)),this._defaultLabelLine(r)},l.prototype.mergeOption=function(){a.prototype.mergeOption.apply(this,arguments)},l.prototype.getInitialData=function(){return We(this,{coordDimensions:["value"],encodeDefaulter:ye(Ue,this)})},l.prototype.getDataParams=function(r){var e=this.getData(),n=st(e),o=n.seats;if(!o){var t=[];e.each(e.mapDimension("value"),function(v){t.push(v)}),o=n.seats=Xe(t,e.hostModel.get("percentPrecision"))}var c=a.prototype.getDataParams.call(this,r);return c.percent=o[r]||0,c.$vars.push("percent"),c},l.prototype._defaultLabelLine=function(r){ze(r,"labelLine",["show"]);var e=r.labelLine,n=r.emphasis.labelLine;e.show=e.show&&r.label.show,n.show=n.show&&r.emphasis.label.show},l.type="series.pie",l.defaultOption={z:2,legendHoverLink:!0,colorBy:"data",center:["50%","50%"],radius:[0,"75%"],clockwise:!0,startAngle:90,minAngle:0,minShowLabelAngle:0,selectedOffset:10,percentPrecision:2,stillShowZeroSum:!0,left:0,top:0,right:0,bottom:0,width:null,height:null,label:{rotate:0,show:!0,overflow:"truncate",position:"outer",alignTo:"none",edgeDistance:"25%",bleedMargin:10,distanceToLabelLine:5},labelLine:{show:!0,length:15,length2:15,smooth:!1,minTurnAngle:90,maxSurfaceAngle:90,lineStyle:{width:1,type:"solid"}},itemStyle:{borderWidth:1,borderJoin:"round"},showEmptyCircle:!0,emptyCircleStyle:{color:"lightgray",opacity:1},labelLayout:{hideOverlap:!0},emphasis:{scale:!0,scaleSize:5},avoidLabelOverlap:!0,animationType:"expansion",animationDuration:1e3,animationTypeUpdate:"transition",animationEasingUpdate:"cubicInOut",animationDurationUpdate:500,animationEasing:"cubicInOut"},l}($e);const gt=ot;function ct(a){return{seriesType:a,reset:function(l,r){var e=l.getData();e.filterSelf(function(n){var o=e.mapDimension("value"),t=e.get(o,n);return!(me(t)&&!isNaN(t)&&t<0)})}}}function dt(a){a.registerChartView(lt),a.registerSeriesModel(gt),He("pie",a.registerAction),a.registerLayout(ye(et,"pie")),a.registerProcessor(_e("pie")),a.registerProcessor(ct("pie"))}export{dt as i};
